@if (viewMode() === 'guest') {
  @if(guestId()) {
    <app-guest-portal [guestId]="guestId()!" [isPlannerView]="isPlannerView()"></app-guest-portal>
  } @else {
    <div class="flex items-center justify-center h-screen bg-stone-50">
        <p class="text-xl text-stone-600">Invalid guest link. Please check your URL.</p>
    </div>
  }
} @else {
  @if (isAuthenticated()) {
    <div class="flex h-screen bg-stone-100">
      <!-- Sidebar -->
      <aside class="w-64 bg-white shadow-lg flex flex-col p-4 border-r border-stone-200">
        <div class="text-center py-4 border-b border-stone-200 mb-6">
          <h1 class="text-3xl font-bold text-stone-800">Ever After</h1>
          <p class="text-sm text-stone-500 mt-1">Olivia & Liam</p>
        </div>
        <nav class="flex-grow">
          <ul class="space-y-2">
            @for (item of (navItems | keyvalue); track item.key) {
              <li>
                <button
                  (click)="changeView(item.key)"
                  [class.bg-rose-50]="selectedView() === item.key"
                  [class.text-rose-600]="selectedView() === item.key"
                  [class.text-stone-600]="selectedView() !== item.key"
                  class="w-full flex items-center p-3 rounded-lg hover:bg-rose-50 hover:text-rose-600 transition-colors duration-200">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" [attr.d]="item.value.icon" />
                  </svg>
                  <span class="font-semibold">{{ item.value.label }}</span>
                </button>
              </li>
            }
          </ul>
        </nav>
        <div class="pt-4 mt-auto border-t border-stone-200">
           <button (click)="logout()" class="w-full flex items-center p-3 rounded-lg text-stone-600 hover:bg-stone-100 hover:text-stone-800 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m-3-3l-3 3m0 0l3 3m-3-3h9" />
            </svg>
            <span class="font-semibold">Logout</span>
          </button>
          <div class="text-center pt-2">
            <p class="text-xs text-stone-400">Wedding Day</p>
            <p class="text-lg font-semibold text-stone-700">Oct 26, 2024</p>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 p-8 overflow-y-auto">
        <div class="max-w-7xl mx-auto">
          @switch (selectedView()) {
            @case ('dashboard') {
              <app-dashboard></app-dashboard>
            }
            @case ('schedule') {
              <app-schedule></app-schedule>
            }
            @case ('gallery') {
              <app-gallery></app-gallery>
            }
            @case ('guest-list') {
              <app-guest-list></app-guest-list>
            }
            @case ('invite-links') {
              <app-invite-links></app-invite-links>
            }
            @case ('assistant') {
              <app-ai-assistant></app-ai-assistant>
            }
          }
        </div>
      </main>
    </div>
  } @else {
    <app-login></app-login>
  }
}
