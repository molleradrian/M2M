<div class="space-y-8">
  <header class="pb-6 border-b border-stone-200">
    <h2 class="text-4xl font-bold text-stone-800">Vendor Discovery</h2>
    <p class="mt-2 text-lg text-stone-600">Find the perfect suppliers for your special day.</p>
  </header>

  <!-- Search and Filter -->
  <div class="bg-white p-4 rounded-2xl shadow-md border border-stone-200 flex flex-col md:flex-row gap-4">
    <div class="relative flex-grow">
      <input 
        type="text"
        placeholder="Search by name or location..."
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        (keyup.enter)="search()"
        class="w-full p-3 pl-10 border border-stone-300 rounded-lg focus:ring-2 focus:ring-rose-400 focus:border-rose-400 outline-none transition duration-200">
      <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-stone-400">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
      </div>
    </div>
    <select 
      [ngModel]="categoryFilter()"
      (ngModelChange)="categoryFilter.set($event); search()"
      class="p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-rose-400 focus:border-rose-400 outline-none transition duration-200">
      <option value="All">All Categories</option>
      @for(cat of categories; track cat) {
        <option [value]="cat">{{ cat }}</option>
      }
    </select>
    <button (click)="search()" class="bg-rose-500 text-white rounded-lg px-6 py-3 font-semibold hover:bg-rose-600 transition-colors">
      Search
    </button>
  </div>

  <!-- Results -->
  <div class="min-h-[400px]">
    @if (isLoading()) {
      <div class="flex justify-center items-center h-full">
        <svg class="animate-spin h-8 w-8 text-rose-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </div>
    } @else if (vendors().length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (vendor of vendors(); track vendor.id) {
          <div class="bg-white rounded-2xl shadow-md border border-stone-200 overflow-hidden flex flex-col">
            <img [src]="vendor.imageUrl" [alt]="vendor.name" width="400" height="300" class="w-full h-48 object-cover">
            <div class="p-4 flex flex-col flex-grow">
              <span class="px-2 py-1 mb-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-rose-100 text-rose-800 self-start">{{ vendor.category }}</span>
              <h3 class="text-xl font-bold text-stone-800">{{ vendor.name }}</h3>
              <p class="text-sm text-stone-500 mb-2">{{ vendor.location }}</p>
              <div class="flex items-center text-sm text-amber-600 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-amber-500 mr-1"><path fill-rule="evenodd" d="M10.868 2.884c.321-.772 1.415-.772 1.736 0l1.83 4.401 4.753.39c.843.07 1.168 1.127.56 1.69l-3.53 3.396 1.03 4.678c.19  .865-.724 1.52-1.488 1.103L10 16.03l-4.23 2.503c-.764.417-1.678-.238-1.488-1.103l1.03-4.678-3.53-3.396c-.608-.563-.283-1.62.56-1.69l4.753-.39 1.83-4.401z" clip-rule="evenodd" /></svg>
                <span>{{ vendor.rating }}</span>
                <span class="text-stone-400 ml-1">({{ vendor.reviewCount }} reviews)</span>
              </div>
              <div class="mt-auto pt-4 border-t border-stone-200 flex justify-end gap-2">
                 <button (click)="requestInvoice(vendor)" 
                    [disabled]="invoiceStatus()[vendor.id] === 'requested'"
                    class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 disabled:cursor-not-allowed"
                    [class.text-white]="invoiceStatus()[vendor.id] !== 'requested'"
                    [class.bg-rose-500]="invoiceStatus()[vendor.id] !== 'requested'"
                    [class.hover:bg-rose-600]="invoiceStatus()[vendor.id] !== 'requested'"
                    [class.bg-green-500]="invoiceStatus()[vendor.id] === 'requested'"
                    [class.text-white]="invoiceStatus()[vendor.id] === 'requested'">
                    {{ invoiceStatus()[vendor.id] === 'requested' ? 'Requested' : 'Request Invoice' }}
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="text-center py-16 text-stone-500">
        <p>No vendors found matching your criteria.</p>
        <p>Try adjusting your search or filters.</p>
      </div>
    }
  </div>
</div>